<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Miels Du Soir">
<title>Miels Du Soir</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Courier+Prime:ital@0;1&family=Dancing+Script:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--cream:#f5efe6;--gold:#c9a96e;--dark:#1a1108;--amber:#8b5e2a;--text:#2d1f0e;--muted:#9a8070;--card:rgba(255,252,245,0.95);--shadow:0 8px 40px rgba(139,94,42,0.12);--radius:20px;--font-serif:'Cormorant Garamond',Georgia,serif;--font-display:'Playfair Display',serif;--font-mono:'Courier Prime',monospace;--font-script:'Dancing Script',cursive}
body.theme-nuit{--cream:#0e0c09;--card:rgba(20,18,14,0.97);--text:#f0e8d8;--muted:#8a7a6a;--shadow:0 8px 40px rgba(0,0,0,0.5)}
body.theme-pur{--cream:#ffffff;--card:rgba(255,255,255,0.98);--text:#111;--muted:#888;--gold:#333;--shadow:0 4px 20px rgba(0,0,0,0.07)}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;font-family:var(--font-serif);background:var(--cream);color:var(--text);transition:background .5s,color .5s;overflow:hidden}
body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.035'/%3E%3C/svg%3E");pointer-events:none;z-index:0}
#splash{position:fixed;inset:0;background:#0e0b06;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity .9s ease,transform .9s ease}
#splash.hide{opacity:0;transform:scale(1.04);pointer-events:none}
.splash-honey{font-size:3.2rem;margin-bottom:.8rem;animation:honeypulse 2s infinite}
.splash-title{font-family:var(--font-display);font-size:2.6rem;color:#c9a96e;font-style:italic;letter-spacing:.04em;animation:fadeUp 1s ease both}
.splash-sub{color:#7a6a5a;font-size:.8rem;margin-top:.4rem;letter-spacing:.25em;text-transform:uppercase;animation:fadeUp 1.3s ease both}
@keyframes honeypulse{0%,100%{transform:scale(1) rotate(-3deg)}50%{transform:scale(1.12) rotate(3deg)}}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
#app{position:fixed;inset:0;display:flex;flex-direction:column;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);z-index:1}
header{display:flex;align-items:center;justify-content:space-between;padding:14px 18px 8px;flex-shrink:0}
.logo{font-family:var(--font-display);font-size:1.4rem;font-style:italic;color:var(--gold);letter-spacing:.02em}
.logo small{font-style:normal;font-size:.75rem;opacity:.7;margin-left:2px}
.header-right{display:flex;gap:8px}
.icon-btn{width:36px;height:36px;border-radius:50%;border:1px solid rgba(201,169,110,.25);background:var(--card);display:flex;align-items:center;justify-content:center;font-size:1rem;cursor:pointer;transition:all .2s;box-shadow:0 2px 8px rgba(139,94,42,.08)}
.icon-btn:active{transform:scale(.9)}
.tabs{display:flex;padding:0 18px 8px;gap:0;flex-shrink:0;border-bottom:1px solid rgba(201,169,110,.12)}
.tab{flex:1;padding:8px 4px;border:none;background:transparent;font-family:var(--font-serif);font-size:.82rem;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .25s;letter-spacing:.06em}
.tab.active{color:var(--gold);border-bottom-color:var(--gold);font-weight:600}
.page{display:none;flex-direction:column;flex:1;overflow:hidden}
.page.active{display:flex}
.scroll-area{flex:1;overflow-y:auto;padding:14px 18px 24px;-webkit-overflow-scrolling:touch}
.scroll-area::-webkit-scrollbar{display:none}
.card{background:var(--card);border-radius:var(--radius);padding:15px;margin-bottom:12px;box-shadow:var(--shadow);border:1px solid rgba(201,169,110,.13);transition:background .5s}
.lbl{font-size:.68rem;letter-spacing:.13em;color:var(--muted);text-transform:uppercase;margin-bottom:5px;font-family:var(--font-serif)}
.style-pills{display:flex;gap:7px;margin-bottom:13px}
.pill{padding:7px 15px;border-radius:30px;border:1.5px solid rgba(201,169,110,.35);background:transparent;font-family:var(--font-serif);font-size:.82rem;color:var(--muted);cursor:pointer;transition:all .2s;letter-spacing:.03em;flex:1;text-align:center}
.pill.active{background:var(--gold);border-color:var(--gold);color:#fff}
select{width:100%;padding:10px 14px;border:1.5px solid rgba(201,169,110,.28);border-radius:12px;background:var(--card);font-family:var(--font-serif);font-size:.88rem;color:var(--text);appearance:none;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='7' viewBox='0 0 10 7'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23c9a96e' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 13px center;cursor:pointer;margin-bottom:9px;transition:border-color .2s}
select:focus{outline:none;border-color:var(--gold)}
textarea{width:100%;border:1.5px solid rgba(201,169,110,.28);border-radius:12px;padding:11px 13px;font-family:var(--font-serif);font-size:.95rem;color:var(--text);background:var(--card);resize:none;min-height:75px;line-height:1.6;transition:border-color .2s,background .5s}
textarea:focus{outline:none;border-color:var(--gold)}
textarea::placeholder{color:var(--muted);font-style:italic}
.row{display:flex;gap:8px;align-items:center;margin-bottom:9px}
.dice-btn{background:none;border:1.5px solid rgba(201,169,110,.35);border-radius:10px;width:38px;height:38px;font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .35s;flex-shrink:0}
.dice-btn:active{transform:rotate(360deg) scale(.9)}
.dice-hint{font-family:var(--font-serif);font-style:italic;color:var(--gold);font-size:.85rem;flex:1}
.mic-btn{display:flex;align-items:center;gap:8px;padding:9px 14px;border:1.5px solid rgba(201,169,110,.3);border-radius:11px;background:none;font-family:var(--font-serif);font-size:.82rem;color:var(--muted);cursor:pointer;width:100%;transition:all .2s;margin-bottom:9px}
.mic-btn.recording{border-color:#e05;color:#e05;animation:micpulse 1s infinite}
@keyframes micpulse{0%,100%{box-shadow:0 0 0 0 rgba(238,0,85,.3)}50%{box-shadow:0 0 0 8px rgba(238,0,85,0)}}
.gen-btn{width:100%;padding:14px;background:linear-gradient(135deg,#c9a96e,#8b5e2a);border:none;border-radius:14px;color:#fff;font-family:var(--font-display);font-size:1.05rem;font-style:italic;letter-spacing:.05em;cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.gen-btn::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.12),transparent)}
.gen-btn:active{transform:scale(.97)}
.gen-btn.loading{opacity:.7;pointer-events:none}
#result-section{display:none}
#result-section.visible{display:block}
.hist-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:9px}
.hist-btn{background:none;border:1px solid rgba(201,169,110,.3);border-radius:7px;width:30px;height:30px;font-size:1rem;cursor:pointer;color:var(--muted);display:flex;align-items:center;justify-content:center;transition:all .2s}
.hist-btn:disabled{opacity:.25;cursor:not-allowed}
.hist-lbl{font-size:.7rem;color:var(--muted);letter-spacing:.1em;font-family:var(--font-serif)}
.poem-preview{border-radius:16px;padding:22px 18px;min-height:140px;max-height:280px;overflow-y:auto;-webkit-overflow-scrolling:touch;transition:all .4s;position:relative}
.poem-preview::-webkit-scrollbar{display:none}
.poem-preview.classic{background:#f7f0e3;font-family:'Cormorant Garamond',serif;color:#2d1f0e;border:1px solid rgba(201,169,110,.18)}
.poem-preview.nuit{background:#0a0a0a;font-family:'Courier Prime',monospace;color:#f0e8d8;border:1px solid rgba(201,169,110,.08)}
.poem-preview.pur{background:#ffffff;font-family:'Dancing Script',cursive;color:#111;border:1px solid #ebebeb}
.poem-text{font-size:1rem;line-height:1.9;font-style:italic;white-space:pre-wrap;word-break:break-word}
.poem-legend{margin-top:14px;font-size:.75rem;color:var(--muted);letter-spacing:.07em;font-style:normal;font-family:var(--font-serif);border-top:1px solid rgba(201,169,110,.18);padding-top:9px;white-space:pre-wrap}
.theme-dots{display:flex;gap:14px;justify-content:center;margin:10px 0 2px}
.theme-dot{width:26px;height:26px;border-radius:50%;cursor:pointer;border:2px solid transparent;transition:all .2s;display:flex;align-items:center;justify-content:center;font-size:.65rem}
.theme-dot.active{transform:scale(1.2)}
.dot-classic{background:#f7f0e3;border-color:#c9a96e}
.dot-nuit{background:#0a0a0a;border-color:#444}
.dot-pur{background:#fff;border-color:#ddd}
.action-row{display:flex;gap:7px;margin-top:11px;flex-wrap:wrap}
.action-btn{flex:1;min-width:70px;padding:9px 6px;border:1.5px solid rgba(201,169,110,.28);border-radius:10px;background:none;font-family:var(--font-serif);font-size:.75rem;color:var(--text);cursor:pointer;transition:all .2s;text-align:center}
.action-btn:active{background:rgba(201,169,110,.1)}
.canva-btn{display:flex;align-items:center;justify-content:center;gap:7px;width:100%;padding:12px;background:linear-gradient(135deg,#00c4cc,#0070f3);border:none;border-radius:13px;color:#fff;font-family:var(--font-serif);font-size:.88rem;letter-spacing:.04em;cursor:pointer;margin-top:10px;text-decoration:none;font-weight:600}
.carousel-slides{display:none;flex-direction:column;gap:9px;margin-top:11px}
.carousel-slides.visible{display:flex}
.carousel-slide{background:var(--card);border-radius:12px;padding:15px;border:1px solid rgba(201,169,110,.18);position:relative}
.slide-num{position:absolute;top:8px;right:10px;font-size:.65rem;color:var(--muted);letter-spacing:.1em}
.slide-text{font-family:var(--font-serif);font-style:italic;line-height:1.85;font-size:.9rem;white-space:pre-wrap}
.copy-slide{margin-top:7px;padding:5px 11px;background:none;border:1px solid rgba(201,169,110,.28);border-radius:7px;font-size:.72rem;color:var(--muted);cursor:pointer;font-family:var(--font-serif)}
.settings-title{font-family:var(--font-display);font-size:1rem;color:var(--gold);margin-bottom:11px;padding-bottom:5px;border-bottom:1px solid rgba(201,169,110,.18)}
.api-row{display:flex;gap:7px;align-items:center}
.api-input{flex:1;padding:9px 13px;border:1.5px solid rgba(201,169,110,.28);border-radius:11px;background:var(--card);font-family:var(--font-mono);font-size:.75rem;color:var(--text)}
.api-input:focus{outline:none;border-color:var(--gold)}
.api-ok{font-size:.7rem;color:var(--gold);margin-top:4px;font-style:italic;display:none}
.api-ok.show{display:block}
.draft-card{background:var(--card);border-radius:var(--radius);padding:15px;margin-bottom:11px;border:1px solid rgba(201,169,110,.13);box-shadow:var(--shadow);cursor:pointer;transition:all .2s}
.draft-card:active{transform:scale(.98)}
.draft-title{font-family:var(--font-display);font-size:.95rem;color:var(--gold);margin-bottom:3px}
.draft-preview{font-family:var(--font-serif);font-style:italic;font-size:.82rem;color:var(--muted);line-height:1.6;overflow:hidden;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical}
.draft-meta{display:flex;gap:8px;align-items:center;margin-top:7px;font-size:.68rem;color:var(--muted)}
.draft-tag{padding:2px 8px;background:rgba(201,169,110,.1);border-radius:20px;color:var(--gold)}
.sched-row{display:flex;align-items:center;gap:7px;margin-top:7px}
.sched-input{padding:4px 9px;border:1px solid rgba(201,169,110,.28);border-radius:7px;background:var(--card);font-family:var(--font-serif);font-size:.74rem;color:var(--text)}
.week-cal{display:flex;gap:5px;margin-bottom:14px;overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:3px}
.week-cal::-webkit-scrollbar{display:none}
.day-col{flex-shrink:0;width:42px;display:flex;flex-direction:column;align-items:center;gap:3px}
.day-ltr{font-size:.66rem;color:var(--muted);letter-spacing:.05em}
.day-circ{width:34px;height:34px;border-radius:50%;border:1.5px solid rgba(201,169,110,.28);display:flex;align-items:center;justify-content:center;font-size:.76rem;color:var(--muted);cursor:pointer;transition:all .2s}
.day-circ.has-post{background:rgba(201,169,110,.15);color:var(--gold);border-color:var(--gold)}
.day-circ.today{background:var(--gold);color:#fff;border-color:var(--gold)}
.day-dot{width:5px;height:5px;border-radius:50%;background:var(--gold)}
.empty-state{text-align:center;padding:40px 20px}
.empty-icon{font-size:2.5rem;margin-bottom:11px}
.empty-text{font-family:var(--font-serif);font-style:italic;color:var(--muted);font-size:.9rem;line-height:1.7}
#toast{position:fixed;bottom:90px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--dark);color:#f5efe6;padding:9px 22px;border-radius:30px;font-family:var(--font-serif);font-size:.82rem;transition:transform .3s ease;z-index:1000;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,.3)}
#toast.show{transform:translateX(-50%) translateY(0)}
body.theme-nuit #toast{background:#2a1f10}
.bottom-nav{display:flex;background:var(--card);border-top:1px solid rgba(201,169,110,.13);padding-bottom:env(safe-area-inset-bottom);flex-shrink:0;backdrop-filter:blur(10px)}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:9px 4px 7px;cursor:pointer;border:none;background:none;transition:all .2s}
.nav-item:active{transform:scale(.9)}
.nav-icon{font-size:1.25rem}
.nav-lbl{font-size:.58rem;color:var(--muted);letter-spacing:.08em;font-family:var(--font-serif);text-transform:uppercase}
.nav-item.active .nav-lbl{color:var(--gold)}
@keyframes slideUp{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}
.page.active .card{animation:slideUp .35s ease both}
.page.active .card:nth-child(2){animation-delay:.06s}
.page.active .card:nth-child(3){animation-delay:.11s}
.loading-dots{display:inline-flex;gap:4px;align-items:center}
.loading-dots span{width:5px;height:5px;background:#fff;border-radius:50%;animation:dot 1.2s infinite}
.loading-dots span:nth-child(2){animation-delay:.2s}
.loading-dots span:nth-child(3){animation-delay:.4s}
@keyframes dot{0%,80%,100%{transform:scale(.5);opacity:.4}40%{transform:scale(1);opacity:1}}
input[type=text].field-input{width:100%;padding:9px 13px;border:1.5px solid rgba(201,169,110,.28);border-radius:11px;background:var(--card);font-family:var(--font-serif);font-size:.88rem;color:var(--text)}
input[type=text].field-input:focus{outline:none;border-color:var(--gold)}
</style>
</head>
<body>

<div id="splash">
  <div class="splash-honey">üçØ</div>
  <div class="splash-title">Miels Du Soir</div>
  <div class="splash-sub">Atelier Po√©tique</div>
</div>

<div id="app">
  <header>
    <div class="logo">Miels Du Soir <small>üçØ</small></div>
    <div class="header-right">
      <button class="icon-btn" onclick="showPage('settings')">‚öôÔ∏è</button>
    </div>
  </header>

  <div class="tabs">
    <button class="tab active" data-page="create">‚úçÔ∏è Cr√©er</button>
    <button class="tab" data-page="drafts">üìÇ Brouillons</button>
    <button class="tab" data-page="settings">‚öôÔ∏è R√©glages</button>
  </div>

  <!-- PAGE CR√âER -->

  <div class="page active" id="page-create">
    <div class="scroll-area">

```
  <div class="card">
    <div class="lbl">Style</div>
    <div class="style-pills">
      <button class="pill active" data-style="Po√®me">üìú Po√®me</button>
      <button class="pill" data-style="Prose">üìñ Prose</button>
      <button class="pill" data-style="Ha√Øku">üå∏ Ha√Øku</button>
    </div>
    <div class="lbl">S'inspirer de</div>
    <select id="poet-select">
      <option value="">‚Äî Choisir un po√®te ‚Äî</option>
      <optgroup label="Classiques">
        <option>Pablo Neruda</option><option>Rumi</option><option>Khalil Gibran</option>
        <option>Victor Hugo</option><option>Arthur Rimbaud</option><option>Paul Verlaine</option>
        <option>Charles Baudelaire</option><option>Emily Dickinson</option><option>Sylvia Plath</option>
        <option>Walt Whitman</option><option>Apollinaire</option><option>Lamartine</option>
      </optgroup>
      <optgroup label="Instapoets">
        <option>Rupi Kaur</option><option>Atticus</option><option>R.H. Sin</option>
        <option>Nikita Gill</option><option>Lang Leav</option><option>r.m. drake</option>
        <option>Amanda Lovelace</option><option>Alfa Poetry</option><option>Najwa Zebian</option>
        <option>Christopher Poindexter</option><option>Tyler Knott Gregson</option>
        <option>Beau Taplin</option><option>Pierre Jeanty</option><option>Yung Pueblo</option>
        <option>Pavana</option><option>Mirtha Michelle</option><option>Wilder Poetry</option>
      </optgroup>
      <optgroup label="Francophones">
        <option>Jacques Pr√©vert</option><option>L√©opold S√©dar Senghor</option>
        <option>Aim√© C√©saire</option><option>Andr√©e Chedid</option><option>Marie No√´l</option>
      </optgroup>
    </select>
    <div class="lbl">Tonalit√©</div>
    <select id="tone-select">
      <option value="">‚Äî Choisir une tonalit√© ‚Äî</option>
      <optgroup label="D√©sir &amp; Passion">
        <option>√âperdue, amoureuse, sensuelle, √©rotique</option>
        <option>Amoureux, m√©lancolique, passion br√ªlante</option>
        <option>D√©sir doux, timide, fr√©missant</option>
      </optgroup>
      <optgroup label="Ombre &amp; Intensit√©">
        <option>Toxique cool, triste, nostalgique</option>
        <option>Rage douce, douleur √©l√©gante</option>
        <option>M√©lancolie profonde, solitude choisie</option>
      </optgroup>
      <optgroup label="Lumi√®re &amp; R√™ve">
        <option>R√™veur, instapoet, doux</option>
        <option>Po√©tique, lumineux, plein d'espoir</option>
        <option>Mystique, envo√ªtant, hypnotique</option>
      </optgroup>
      <optgroup label="Puissance">
        <option>Fort, affirm√©, lib√©r√©</option>
        <option>Sauvage, brut, visc√©ral</option>
      </optgroup>
    </select>
  </div>

  <div class="card">
    <div class="row">
      <div class="lbl" style="margin:0">Th√®me / Id√©e</div>
    </div>
    <div class="row">
      <button class="dice-btn" onclick="rollDice()">üé≤</button>
      <div class="dice-hint" id="dice-hint">Lance le d√© pour l'inspiration‚Ä¶</div>
    </div>
    <button class="mic-btn" id="mic-btn" onclick="toggleMic()">
      <span id="mic-icon">üé§</span>
      <span id="mic-lbl">Dicter mon id√©e √† voix haute</span>
    </button>
    <textarea id="prompt-input" rows="3" placeholder="Ex: la lumi√®re d'automne sur les feuilles mortes‚Ä¶"></textarea>
  </div>

  <button class="gen-btn" id="gen-btn" onclick="generatePoem()">
    <span id="gen-label">‚ú® √âcrire pour moi</span>
  </button>

  <div id="result-section">
    <div class="card" style="margin-top:12px">
      <div class="hist-nav">
        <button class="hist-btn" id="hist-prev" onclick="navHist(-1)" disabled>‚Äπ</button>
        <span class="hist-lbl" id="hist-lbl">Ma cr√©ation</span>
        <button class="hist-btn" id="hist-next" onclick="navHist(1)" disabled>‚Ä∫</button>
      </div>
      <div class="poem-preview classic" id="poem-preview">
        <div class="poem-text" id="poem-text"></div>
        <div class="poem-legend" id="poem-legend"></div>
      </div>
      <div class="theme-dots">
        <div class="theme-dot dot-classic active" onclick="setPrevTheme('classic',this)" title="Classique">üçÇ</div>
        <div class="theme-dot dot-nuit" onclick="setPrevTheme('nuit',this)" title="Nuit">üåô</div>
        <div class="theme-dot dot-pur" onclick="setPrevTheme('pur',this)" title="Pur">‚òÅÔ∏è</div>
      </div>
      <div class="action-row">
        <button class="action-btn" onclick="copyPoem()">üìã Copier</button>
        <button class="action-btn" onclick="saveDraft()">üíæ Brouillon</button>
        <button class="action-btn" onclick="makeCarousel()">üì± Carrousel</button>
        <button class="action-btn" onclick="generatePoem()">‚Ü∫ Regen.</button>
      </div>
      <a class="canva-btn" href="https://www.canva.com/fr_fr/" target="_blank">üé® Ouvrir dans Canva</a>
    </div>
    <div id="carousel-section" class="carousel-slides">
      <div class="card" style="margin-top:0">
        <div class="lbl" style="margin-bottom:9px">üì± Carrousel Instagram</div>
        <div id="carousel-container"></div>
      </div>
    </div>
  </div>
</div>
```

  </div>

  <!-- PAGE BROUILLONS -->

  <div class="page" id="page-drafts">
    <div class="scroll-area">
      <div class="card">
        <div class="lbl" style="margin-bottom:9px">Calendrier √©ditorial</div>
        <div class="week-cal" id="week-cal"></div>
      </div>
      <div id="drafts-list"></div>
    </div>
  </div>

  <!-- PAGE R√âGLAGES -->

  <div class="page" id="page-settings">
    <div class="scroll-area">
      <div class="card">
        <div class="settings-title">üîë Cl√©s API</div>
        <div class="lbl">Claude (Anthropic)</div>
        <div class="api-row">
          <input type="password" class="api-input" id="claude-key" placeholder="sk-ant-api03-‚Ä¶" oninput="saveKey('claude',this.value)">
          <button class="icon-btn" onclick="toggleVis('claude-key')">üëÅ</button>
        </div>
        <div class="api-ok" id="ok-claude">‚úì Cl√© enregistr√©e</div>
        <br>
        <div class="lbl">Gemini (Google)</div>
        <div class="api-row">
          <input type="password" class="api-input" id="gemini-key" placeholder="AIzaSy‚Ä¶" oninput="saveKey('gemini',this.value)">
          <button class="icon-btn" onclick="toggleVis('gemini-key')">üëÅ</button>
        </div>
        <div class="api-ok" id="ok-gemini">‚úì Cl√© enregistr√©e</div>
        <br>
        <div class="lbl">Fournisseur actif</div>
        <select id="api-provider" onchange="localStorage.setItem('provider',this.value)">
          <option value="claude">Claude (Anthropic)</option>
          <option value="gemini">Gemini (Google)</option>
        </select>
      </div>

```
  <div class="card">
    <div class="settings-title">üé® Th√®me global</div>
    <div class="style-pills">
      <button class="pill active" id="thbtn-classic" onclick="setTheme('',this)">üçÇ Classique</button>
      <button class="pill" id="thbtn-nuit" onclick="setTheme('theme-nuit',this)">üåô Nuit</button>
      <button class="pill" id="thbtn-pur" onclick="setTheme('theme-pur',this)">‚òÅÔ∏è Pur</button>
    </div>
  </div>

  <div class="card">
    <div class="settings-title">‚úçÔ∏è Ma Signature</div>
    <div class="lbl">Nom de plume</div>
    <input type="text" class="field-input" id="pen-name" placeholder="‚Äî votre nom ‚Äî" oninput="localStorage.setItem('penName',this.value)" style="width:100%;padding:9px 13px;border:1.5px solid rgba(201,169,110,.28);border-radius:11px;background:var(--card);font-family:var(--font-serif);font-size:.88rem;color:var(--text);margin-bottom:10px">
    <div class="lbl">Hashtags / l√©gende par d√©faut</div>
    <textarea id="default-legend" rows="3" placeholder="#poesie #instapoet #mieldusoir" style="min-height:60px" oninput="localStorage.setItem('legend',this.value)"></textarea>
  </div>

  <div class="card">
    <div class="settings-title">‚ÑπÔ∏è Miels Du Soir</div>
    <p style="font-family:var(--font-serif);font-style:italic;color:var(--muted);font-size:.86rem;line-height:1.75">Votre atelier po√©tique personnel. Cr√©ez, inspirez-vous, publiez ‚Äî chaque soir, comme un rituel doux et n√©cessaire.</p>
  </div>
</div>
```

  </div>

  <nav class="bottom-nav">
    <button class="nav-item active" data-page="create" onclick="showPage('create')">
      <span class="nav-icon">‚úçÔ∏è</span><span class="nav-lbl">Cr√©er</span>
    </button>
    <button class="nav-item" data-page="drafts" onclick="showPage('drafts')">
      <span class="nav-icon">üìÇ</span><span class="nav-lbl">Brouillons</span>
    </button>
    <button class="nav-item" data-page="settings" onclick="showPage('settings')">
      <span class="nav-icon">‚öôÔ∏è</span><span class="nav-lbl">R√©glages</span>
    </button>
  </nav>
</div>

<div id="toast"></div>

<script>
let currentStyle='Po√®me',currentPoem='',currentLegend='',poemHistory=[],histIdx=-1,isRecording=false,recog=null;
let drafts=JSON.parse(localStorage.getItem('drafts')||'[]');

const THEMES=["la lumi√®re d'automne sur les feuilles mortes","l'attente entre deux messages","une bouche qui ne dit plus mon pr√©nom","les nuits o√π le silence devient bruit","partir sans se retourner","le go√ªt du miel sur des l√®vres froides","un amour toxique comme un parfum qu'on aime trop","les mains qui se cherchent dans le noir","l'heure bleue entre chien et loup","une lettre jamais envoy√©e","le c≈ìur qui bat trop vite pour rien","les fleurs qui poussent dans les ruines","se perdre pour mieux se retrouver","les derniers mots d'une histoire","la br√ªlure douce d'un souvenir","l'odeur de pluie sur la peau chaude","danser seule dans une pi√®ce vide","les cicatrices invisibles","un coucher de soleil vu √† deux","l'insomnie comme une forme d'amour","tout ce qu'on ne s'est pas dit","les yeux qui racontent ce que la bouche tait","l'√©t√© qu'on n'a pas eu","revenir √† soi apr√®s quelqu'un","le dernier baiser qu'on n'a pas donn√©"];

window.onload=()=>{
  setTimeout(()=>{
    document.getElementById('splash').classList.add('hide');
    setTimeout(()=>document.getElementById('splash').style.display='none',900);
  },1900);
  loadSettings();renderCal();renderDrafts();
};

function loadSettings(){
  const ck=localStorage.getItem('claude_key'),gk=localStorage.getItem('gemini_key');
  const leg=localStorage.getItem('legend'),pn=localStorage.getItem('penName'),prov=localStorage.getItem('provider'),th=localStorage.getItem('theme');
  if(ck){document.getElementById('claude-key').value=ck;document.getElementById('ok-claude').classList.add('show')}
  if(gk){document.getElementById('gemini-key').value=gk;document.getElementById('ok-gemini').classList.add('show')}
  if(leg)document.getElementById('default-legend').value=leg;
  if(pn)document.getElementById('pen-name').value=pn;
  if(prov)document.getElementById('api-provider').value=prov;
  if(th){document.body.className=th;document.querySelectorAll('#page-settings .pill').forEach(p=>p.classList.remove('active'));const btn=document.getElementById('thbtn-'+th.replace('theme-','')||'classic');if(btn)btn.classList.add('active')}
}

function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab,.nav-item').forEach(t=>t.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  document.querySelectorAll('[data-page="'+name+'"]').forEach(el=>el.classList.add('active'));
  if(name==='drafts'){renderCal();renderDrafts();}
}
document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>showPage(t.dataset.page)));

document.querySelectorAll('.pill[data-style]').forEach(pill=>{
  pill.addEventListener('click',()=>{
    document.querySelectorAll('.pill[data-style]').forEach(p=>p.classList.remove('active'));
    pill.classList.add('active');currentStyle=pill.dataset.style;
  });
});

function rollDice(){
  const th=THEMES[Math.floor(Math.random()*THEMES.length)];
  const btn=document.querySelector('.dice-btn');
  btn.style.transform='rotate(360deg) scale(1.15)';
  setTimeout(()=>btn.style.transform='',400);
  const d=document.getElementById('dice-hint');
  d.style.opacity='0';
  setTimeout(()=>{d.textContent=th;d.style.opacity='1';d.style.transition='opacity .2s';document.getElementById('prompt-input').value=th;},200);
}

function toggleMic(){
  if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window)){showToast('Dictaphone non support√© ici');return}
  if(isRecording){recog.stop();return}
  recog=new(window.SpeechRecognition||window.webkitSpeechRecognition)();
  recog.lang='fr-FR';recog.continuous=false;recog.interimResults=false;
  recog.onresult=e=>{document.getElementById('prompt-input').value=e.results[0][0].transcript;showToast('‚úì Id√©e capt√©e !')};
  recog.onend=()=>{isRecording=false;document.getElementById('mic-btn').classList.remove('recording');document.getElementById('mic-icon').textContent='üé§';document.getElementById('mic-lbl').textContent='Dicter mon id√©e √† voix haute'};
  recog.start();isRecording=true;
  document.getElementById('mic-btn').classList.add('recording');
  document.getElementById('mic-icon').textContent='‚èπ';document.getElementById('mic-lbl').textContent='Appuyez pour arr√™ter‚Ä¶';
}

async function generatePoem(){
  const poet=document.getElementById('poet-select').value;
  const tone=document.getElementById('tone-select').value;
  const prompt=document.getElementById('prompt-input').value.trim();
  const provider=localStorage.getItem('provider')||'claude';
  const btn=document.getElementById('gen-btn');
  btn.classList.add('loading');
  document.getElementById('gen-label').innerHTML='<span class="loading-dots"><span></span><span></span><span></span></span>';
  
  const sys=`Tu es un po√®te inspir√© qui √©crit en fran√ßais. Tu cr√©es des textes originaux de haute qualit√© pour Instagram, sans jamais mentionner que tu es une intelligence artificielle. √âcris uniquement le texte po√©tique, sans titre entre guillemets, sans introduction ni explication. Pour un Ha√Øku: exactement 3 lignes (5-7-5 syllabes). Pour un Po√®me: 3 √† 5 strophes. Pour une Prose: un paragraphe dense et lyrique. √Ä la fin, ajoute deux sauts de ligne puis une courte l√©gende (1-2 phrases) commen√ßant par L√âGENDE: pour accompagner la publication Instagram.`;
  const user=`Style: ${currentStyle}\n${poet?'Inspire-toi de: '+poet:''}\n${tone?'Tonalit√©: '+tone:''}\n${prompt?'Th√®me: '+prompt:'Th√®me libre, po√©tique et fort'}\n\n√âcris maintenant.`;
  
  let poem='',legend='';
  try{
    if(provider==='claude'){
      const k=localStorage.getItem('claude_key');
      if(!k)throw new Error('no_key');
      const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':k,'anthropic-version':'2023-06-01'},body:JSON.stringify({model:'claude-opus-4-6',max_tokens:900,system:sys,messages:[{role:'user',content:user}]})});
      const d=await r.json();
      if(d.error)throw new Error(d.error.message);
      poem=d.content[0].text;
    }else{
      const k=localStorage.getItem('gemini_key');
      if(!k)throw new Error('no_key');
      const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${k}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:sys+'\n\n'+user}]}]})});
      const d=await r.json();
      poem=d.candidates[0].content.parts[0].text;
    }
    const lm=poem.match(/\n\nL√âGENDE:\s*(.+?)(?:\n|$)/s);
    if(lm){legend=lm[1].trim();poem=poem.replace(/\n\nL√âGENDE:.*$/s,'').trim();}
  }catch(e){
    if(e.message==='no_key'){showToast('‚ö†Ô∏è Ajoutez votre cl√© API dans R√©glages');btn.classList.remove('loading');document.getElementById('gen-label').textContent='‚ú® √âcrire pour moi';return}
    poem=getDemo(currentStyle);legend=getDemoLeg();
  }
  
  const saved=localStorage.getItem('legend')||'';
  const pn=localStorage.getItem('penName')||'';
  if(pn||saved)legend=(legend?legend+'\n\n':'')+(pn?'‚Äî '+pn+'\n':'')+saved;
  
  currentPoem=poem;currentLegend=legend;
  poemHistory.unshift({poem,legend});
  if(poemHistory.length>5)poemHistory.pop();
  histIdx=0;updateHistNav();
  displayPoem(poem,legend);
  btn.classList.remove('loading');document.getElementById('gen-label').textContent='‚ú® √âcrire pour moi';
  document.getElementById('carousel-section').classList.remove('visible');
  setTimeout(()=>document.getElementById('result-section').scrollIntoView({behavior:'smooth',block:'start'}),120);
}

function displayPoem(poem,legend){
  document.getElementById('poem-text').textContent=poem;
  const leg=document.getElementById('poem-legend');
  leg.textContent=legend||'';leg.style.display=legend?'block':'none';
  document.getElementById('result-section').classList.add('visible');
  const p=document.getElementById('poem-preview');p.style.opacity='0';
  setTimeout(()=>{p.style.transition='opacity .45s';p.style.opacity='1'},50);
}

function updateHistNav(){
  document.getElementById('hist-prev').disabled=histIdx>=poemHistory.length-1;
  document.getElementById('hist-next').disabled=histIdx<=0;
  document.getElementById('hist-lbl').textContent=poemHistory.length>1?`Version ${histIdx+1}/${poemHistory.length}`:'Ma cr√©ation';
}
function navHist(dir){histIdx=Math.max(0,Math.min(poemHistory.length-1,histIdx+dir));const e=poemHistory[histIdx];displayPoem(e.poem,e.legend);updateHistNav();}

function setPrevTheme(th,el){
  document.getElementById('poem-preview').className='poem-preview '+th;
  document.querySelectorAll('.theme-dot').forEach(d=>d.classList.remove('active'));
  el.classList.add('active');
}

function makeCarousel(){
  if(!currentPoem){showToast('G√©n√©rez un po√®me d\'abord');return}
  const lines=currentPoem.split('\n').filter(l=>l.trim());
  const cs=Math.ceil(lines.length/3);
  const slides=[];
  for(let i=0;i<3;i++){const c=lines.slice(i*cs,(i+1)*cs).join('\n');if(c.trim())slides.push(c);}
  if(currentLegend&&slides.length)slides.push(currentLegend);
  document.getElementById('carousel-container').innerHTML=slides.map((s,i)=>`
    <div class="carousel-slide">
      <div class="slide-num">Slide ${i+1}/${slides.length}</div>
      <div class="slide-text">${s.replace(/</g,'&lt;')}</div>
      <button class="copy-slide" onclick='copyText(${JSON.stringify(s)})'>üìã Copier</button>
    </div>`).join('');
  document.getElementById('carousel-section').classList.add('visible');
  showToast('üì± Carrousel pr√™t !');
  setTimeout(()=>document.getElementById('carousel-section').scrollIntoView({behavior:'smooth'}),100);
}

function copyPoem(){copyText(currentPoem+(currentLegend?'\n\n'+currentLegend:''));}
function copyText(t){
  navigator.clipboard.writeText(t).then(()=>showToast('‚úì Copi√© !')).catch(()=>{
    const ta=document.createElement('textarea');ta.value=t;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);showToast('‚úì Copi√© !');
  });
}

function saveDraft(){
  if(!currentPoem)return;
  const d={id:Date.now(),poem:currentPoem,legend:currentLegend,style:currentStyle,poet:document.getElementById('poet-select').value,tone:document.getElementById('tone-select').value,date:new Date().toLocaleDateString('fr-FR'),postDate:null};
  drafts.unshift(d);localStorage.setItem('drafts',JSON.stringify(drafts));renderDrafts();showToast('üíæ Sauvegard√© !');
}

function renderDrafts(){
  const c=document.getElementById('drafts-list');
  if(!drafts.length){c.innerHTML='<div class="empty-state"><div class="empty-icon">üìù</div><div class="empty-text">Vos brouillons appara√Ætront ici.<br>Cr√©ez votre premier po√®me ‚ú®</div></div>';return;}
  c.innerHTML=drafts.map(d=>`
    <div class="draft-card" onclick="loadDraft(${d.id})">
      <div class="draft-title">${d.style}${d.tone?' ¬∑ '+d.tone.split(',')[0]:''}</div>
      <div class="draft-preview">${d.poem.replace(/</g,'&lt;')}</div>
      <div class="draft-meta">
        <span class="draft-tag">${d.style}</span>
        <span>${d.date}</span>
        ${d.postDate?'<span>üìÖ '+d.postDate+'</span>':''}
        <button onclick="event.stopPropagation();delDraft(${d.id})" style="margin-left:auto;background:none;border:none;color:var(--muted);cursor:pointer;font-size:.78rem;padding:3px 6px">‚úï</button>
      </div>
      <div class="sched-row">
        <span style="font-size:.68rem;color:var(--muted);font-family:var(--font-serif)">Poster le :</span>
        <input type="date" class="sched-input" value="${d.postDate||''}" onchange="setPostDate(${d.id},this.value)" onclick="event.stopPropagation()">
      </div>
    </div>`).join('');
}
function loadDraft(id){const d=drafts.find(x=>x.id===id);if(!d)return;currentPoem=d.poem;currentLegend=d.legend;displayPoem(d.poem,d.legend);showPage('create');showToast('üìñ Brouillon charg√©')}
function delDraft(id){drafts=drafts.filter(d=>d.id!==id);localStorage.setItem('drafts',JSON.stringify(drafts));renderDrafts();}
function setPostDate(id,date){const d=drafts.find(x=>x.id===id);if(d){d.postDate=date?new Date(date).toLocaleDateString('fr-FR'):null;localStorage.setItem('drafts',JSON.stringify(drafts));renderCal();}}

function renderCal(){
  const c=document.getElementById('week-cal');
  const days=['L','M','M','J','V','S','D'],today=new Date();
  const mon=new Date(today);const diff=today.getDay()===0?-6:1-today.getDay();mon.setDate(today.getDate()+diff);
  c.innerHTML=days.map((day,i)=>{
    const d=new Date(mon);d.setDate(mon.getDate()+i);
    const ds=d.toLocaleDateString('fr-FR');
    const isToday=d.toDateString()===today.toDateString();
    const has=drafts.some(x=>x.postDate===ds);
    return`<div class="day-col"><div class="day-ltr">${day}</div><div class="day-circ ${isToday?'today':''} ${has?'has-post':''}">${d.getDate()}</div>${has?'<div class="day-dot"></div>':'<div style="height:7px"></div>'}</div>`;
  }).join('');
}

function setTheme(cls,btn){
  document.body.className=cls;
  document.querySelectorAll('#page-settings .pill:not([data-style])').forEach(p=>p.classList.remove('active'));
  if(btn)btn.classList.add('active');
  localStorage.setItem('theme',cls);
}

function saveKey(type,val){localStorage.setItem(type+'_key',val);document.getElementById('ok-'+type).classList.toggle('show',val.length>8);}
function toggleVis(id){const el=document.getElementById(id);el.type=el.type==='password'?'text':'password';}

function showToast(msg){
  const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2200);
}

function getDemo(style){
  const d={
    'Ha√Øku':["tes mains sur ma peau\ncomme la pluie sur les fleurs\net le reste s'efface","soir qui se dissout\nton pr√©nom dans ma bouche encore\nle silence, apr√®s","lumi√®re d'automne\ntu t'en vas comme elle aussi\nles feuilles restent l√†"],
    'Prose':["Il y a des amours qui br√ªlent comme du papier ‚Äî vite, et magnifiquement. Le tien √©tait de cette nature. Je me souviens du soir o√π tu as pos√© ta main dans ma main, sans rien dire. La ville continuait. Le monde continuait. Mais quelque chose, entre nous, venait de prendre feu.","Je t'ai aim√© comme on aime les villes qu'on ne revient jamais habiter. Intens√©ment. Avec la certitude obscure que ce serait bref et beau et que je m'en souviendrais longtemps, assise dans d'autres lumi√®res."],
    'Po√®me':["Tu es partie un mardi\ncomme une chanson qui finit\nsans pr√©venir.\n\nJ'ai cherch√© ton ombre\ndans toutes les heures bleues\nque je ne savais plus habiter.\n\nIl reste ton parfum\nsur un coussin que je retourne\npour ne plus le sentir‚Äî\net pour le sentir encore.","Ce soir le ciel est ton pr√©nom\n√©crit en orange sur mes l√®vres.\n\nJ'apprends la langue du manque,\ncelle qu'on parle seulement\nquand il n'est plus l√†\npour nous r√©pondre.\n\nTu m'as laiss√© ta lumi√®re.\nJe ne sais pas quoi en faire."]
  };
  const list=d[style]||d['Po√®me'];return list[Math.floor(Math.random()*list.length)];
}
function getDemoLeg(){
  const l=["Certains silences p√®sent plus que les mots qu'on n'a pas dits. üçÇ","Pour tous ceux qui aiment trop fort et pas assez √† la fois. ‚ú®","Le c≈ìur a ses propres saisons. üåô","√âcrire pour ne pas oublier. Publier pour ne pas √™tre seul. üïØÔ∏è"];
  const saved=localStorage.getItem('legend')||'',pn=localStorage.getItem('penName')||'';
  const base=l[Math.floor(Math.random()*l.length)];
  return base+(pn?'\n‚Äî '+pn:'')+(saved?'\n'+saved:'');
}

// Theme pills in settings - fix pill click scope
document.querySelectorAll('#page-settings .style-pills .pill').forEach(p=>{
  p.addEventListener('click',()=>{
    document.querySelectorAll('#page-settings .style-pills .pill').forEach(x=>x.classList.remove('active'));
    p.classList.add('active');
  });
});
</script>

</body>
</html>